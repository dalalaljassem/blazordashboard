@page "/"

<BlazePage Title="Dashboard">
    <div class="flex flex-row pb-5 items-center">
        <div class="flex flex-col">
            <h6 class="text-gray">Greetings Dalal</h6>
            <h5 class="font-bold ">Welcome to your Dashboard!</h5>
        </div>
        <div class="ml-auto w-[250px]">
            <MudSelect T="string" @bind-Value="selectedValue" Placeholder="This Month" Dense="true"
                Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.ArrowDropDown"
                AdornmentColor="@Color.Info"
                Class="rounded-md text-sm font-medium text-primary bg-transparent custom-select">
                @foreach (var item in items)
                {
                    <MudSelectItem Value="@item" class="bg-blue">@item</MudSelectItem>
                }
            </MudSelect>
        </div>

    </div>
    <MudGrid>
        <!-- Payment Pending -->
        <MudItem xs="12" md="6">
            <MudPaper Elevation="0" Class="flex flex-col rounded-lg p-4 bg-white py-3 ">
                <div class="flex items-center ">
                    <div class="flex flex-col">
                        <h6 class="text-gray my-0">Pending Payments</h6>
                    </div>
                    <div class="ml-auto text-sm">
                        <span class="statcard-value font-bold text-red">KD 3,200</span>
                    </div>
                </div>
            </MudPaper>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudPaper Elevation="0" Class="flex flex-col rounded-lg p-4 bg-white py-3 ">
                <div class="flex items-center ">
                    <div class="flex flex-col">
                        <h6 class="text-gray my-0">Collected Payments</h6>
                    </div>
                    <div class="ml-auto text-sm">
                        <span class="statcard-value font-bold text-green">KD 21,450</span>
                    </div>
                </div>
            </MudPaper>
        </MudItem>

        <!-- Card 1 -->
        <MudItem xs="12" sm="6" lg="4">
            <StatCard Title="Total Properties" Value="71,897" Icon="@Icons.Material.Filled.HomeWork" Change="122"
                IsPositiveChange="true" />
        </MudItem>

        <!-- Card 2 -->
        <MudItem xs="12" sm="6" lg="4">
            <StatCard Title="Total Leases" Value="71,897" Icon="@Icons.Material.Filled.NoteAdd" Change="90"
                IsPositiveChange="false" />
        </MudItem>

        <!-- Card 3 -->
        <MudItem xs="12" sm="6" lg="4">
            <StatCard Title="Total Tenants" Value="71,897" Icon="@Icons.Material.Filled.Groups" Change="122"
                IsPositiveChange="true" />
        </MudItem>


        <!-- Second Row: Charts -->
        <MudItem xs="12" md="8">
            <MudPaper Elevation="0" Class="px-4 py-2 flex flex-col justify-between rounded-lg">
                <MudText Typo="Typo.h6" Class="mb-2 font-bold">Revenue Overview</MudText>
                <MudChart ChartType="ChartType.StackedBar" ChartSeries="@_series" @bind-SelectedIndex="_index"
                    class="flex items-center" XAxisLabels="@_xAxisLabels" Width="100%" Height="250px"
                    AxisChartOptions="_axisChartOptions">
                </MudChart>
            </MudPaper>
        </MudItem>

        @* <MudItem xs="12" md="8">
        <MudPaper Elevation="1" Class="rounded-xl p-4 shadow-sm flex flex-col gap-4">

        <!-- Header -->
        <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
        <MudAvatar Class="bg-gray-100 text-gray-600" Icon="@Icons.Material.Filled.Groups"
        Size="Size.Medium" />
        <div>
        <MudText Typo="Typo.h5" Class="font-bold text-xl text-gray-900">3.4k</MudText>
        <MudText Typo="Typo.caption" Class="text-gray-500 -mt-1">Leads generated per week</MudText>
        </div>
        </div>
        <MudChip T="string" Color="Color.Success" Variant="Variant.Filled"
        Class="text-sm font-medium px-2 py-1 rounded-md">
        ↑ 42.5%
        </MudChip>
        </div>

        <MudDivider />

        <!-- Spend & Rate Row -->
        <div class="flex justify-between text-sm text-gray-700 font-medium">
        <div>Money spent: <span class="font-bold text-gray-900">$3,232</span></div>
        <div>Conversion rate: <span class="font-bold text-gray-900">1.2%</span></div>
        </div>

        <!-- Chart -->
        <MudChart ChartType="ChartType.StackedBar" ChartSeries="@_series" XAxisLabels="@_xAxisLabels"
        AxisChartOptions="_axisChartOptions" Height="230px" Width="100%" Class="pt-2" />

        <MudDivider />

        <!-- Footer -->
        <div class="flex justify-between items-center text-sm pt-1">
        <MudSelect T="string" Dense="true">
        <MudSelectItem Value=@("Last 7 days")>Last 7 days</MudSelectItem>
        <MudSelectItem Value=@("Last 30 days")>Last 30 days</MudSelectItem>
        </MudSelect>
        <a href="#" class="text-blue-600 font-medium hover:underline">LEADS REPORT</a>
        </div>

        </MudPaper>
        </MudItem> *@


        <MudItem xs="12" md="4">
            <MudPaper Elevation="0" Class="px-4 py-2 flex flex-col justify-between rounded-lg">

                <!-- Header -->
                <div class="w-full flex items-center justify-between">
                    <MudText Typo="Typo.h6" Class="mb-2 font-bold">Property Overview</MudText>
                    <MudIconButton Icon="@Icons.Material.Filled.Download" Size="Size.Small" Class="text-gray-400" />
                </div>
                <!-- Spend & Rate Row -->
                <div class="flex justify-between text-sm text-gray-700 font-medium py-4">
                    <div>Money spent: <span class="font-bold text-gray-900">$3,232</span></div>
                    <div>Conversion rate: <span class="font-bold text-gray-900">1.2%</span></div>
                </div>
                <MudChart ChartType="ChartType.Donut" Width="200px" Height="200px" InputData="@data"
                    InputLabels="@labels">
                    <CustomGraphics>
                        <g>
                            <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" font-size="32"
                                font-weight="bold" fill="black">
                                $134.4k
                            </text>
                            <text x="50%" y="60%" text-anchor="middle" dominant-baseline="middle" font-size="16"
                                fill="#4b4b4b">
                                Total Income
                            </text>
                        </g>
                    </CustomGraphics>
                </MudChart>
            </MudPaper>
        </MudItem>

        @* <MudItem xs="12" md="4">
        <MudPaper Elevation="1" Class="rounded-xl p-4 shadow-sm flex flex-col gap-4 items-center">

        <!-- Header -->
        <div class="w-full flex items-center justify-between">
        <MudText Typo="Typo.h6" Class="font-semibold text-gray-800">Website traffic</MudText>
        <MudIconButton Icon="@Icons.Material.Filled.Download" Size="Size.Small" Class="text-gray-400" />
        </div>

        <!-- Filter options -->
        <div class="w-full flex justify-center gap-2 text-sm text-gray-600">
        <MudChip T="string">Desktop</MudChip>
        <MudChip T="string">Tablet</MudChip>
        <MudChip T="string">Mobile</MudChip>
        </div>

        <!-- Donut chart -->
        <MudChart ChartType="ChartType.Donut" Width="200px" Height="200px" InputData="@data"
        InputLabels="@labels">
        <CustomGraphics>
        <g>
        <text x="50%" y="45%" text-anchor="middle" dominant-baseline="middle"
        font-family="Helvetica" font-size="14" fill="#6B7280">
        $66.4k
        </text>
        <text x="50%" y="60%" text-anchor="middle" dominant-baseline="middle"
        font-family="Helvetica" font-size="12" fill="#9CA3AF">
        Unique visitors
        </text>
        </g>
        </CustomGraphics>
        </MudChart>

        <!-- Footer -->
        <div class="w-full flex justify-between items-center pt-2 text-sm text-gray-500">
        <MudSelect T="string" Class="text-sm" Dense="true">
        <MudSelectItem Value="@("Last 7 days")">Last 7 days</MudSelectItem>
        <MudSelectItem Value=@("Last 30 days")>Last 30 days</MudSelectItem>
        </MudSelect>
        <a href="#" class="font-semibold text-primary">GET ANALYSIS</a>
        </div>
        </MudPaper>
        </MudItem> *@


        <!-- Second Row: Table -->
        <MudItem xs="12" md="12" lg="12">
            <MudPaper Class="p-4 rounded-lg shadow-sm bg-white">
                <div class="flex justify-between items-center pb-4">
                    <MudText Typo="Typo.h6" Class="font-semibold text-primary">Newly Added Properties</MudText>
                    <MudButton Variant="Variant.Outlined" EndIcon="@Icons.Material.Filled.KeyboardArrowRight"
                        Class="text-primary border-primary" OnClick="@(() => Nav.NavigateTo("/properties"))">
                        See All
                    </MudButton>
                </div>

                <MudTable Items="properties" Dense="true" Hover="true" Elevation="0"
                    Class="text-sm text-gray rounded-lg">
                    <HeaderContent>
                        <MudTh>#</MudTh>
                        <MudTh>Name</MudTh>
                        <MudTh>Address</MudTh>
                        <MudTh>Agent</MudTh>
                        <MudTh>Price</MudTh>
                        <MudTh>Status</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="#">@context.Id</MudTd>
                        <MudTd DataLabel="Name">@context.Name</MudTd>
                        <MudTd DataLabel="Address">@context.Address</MudTd>
                        <MudTd DataLabel="Agent">@context.Agent</MudTd>
                        <MudTd DataLabel="Price">@context.Price KWD</MudTd>
                        <MudTd DataLabel="Status">
                            <MudChip T="string" Color="@GetStatusColor(context.Status)">
                                @context.Status
                            </MudChip>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </MudItem>
    </MudGrid>
</BlazePage>


@code {

    [Inject] NavigationManager Nav { get; set; }
    private string selectedValue;
    private List<string> items = new() { "Last Month", "Last 2 Months", "Last 3 Months", "Last 4 Months" };

    private int _index = -1; //default value cannot be 0 -> first selectedindex is 0.
    private string _width = "550px";
    private AxisChartOptions _axisChartOptions = new AxisChartOptions();

    private List<ChartSeries> _series = new List<ChartSeries>()
{
new ChartSeries() { Name = "Revenue Total", Data = new double[] { 40, 20, 25, 27, 46, 60, 48, 80, 15 } },
new ChartSeries() { Name = "Property Sold", Data = new double[] { 19, 24, 35, 13, 28, 15, 13, 16, 31 } },
new ChartSeries() { Name = "Property Rented", Data = new double[] { 8, 6, 11, 13, 4, 16, 10, 16, 18 } },
};

    private int Index = -1; //default value cannot be 0 -> first selectedindex is 0.

    public double[] data = { 25, 77, 28, 5 };
    public string[] labels = { "Apartments", "Villas", "Duplex Houses", "Rooms" };

    private string[] _xAxisLabels = { "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep" };

    public class Property
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Address { get; set; }
        public string Agent { get; set; }
        public decimal Price { get; set; }
        public string Status { get; set; } = "Rent"; // or "Sell"
    }

    private List<Property> properties = new()
{
new Property { Id = 1, Name = "The Cool House", Address = "Shuwaikh", Agent = "Goose House", Price = 2311.55M, Status =
"Sell" },
new Property { Id = 2, Name = "DJ's Dungeon", Address = "Khaldiya", Agent = "MCR", Price = 3522.42M, Status = "Rent" }
};

    private Color GetStatusColor(string status)
    {
        return status switch
        {
            "Sell" => Color.Success,
            "Rent" => Color.Info,
            _ => Color.Default
        };
    }
}